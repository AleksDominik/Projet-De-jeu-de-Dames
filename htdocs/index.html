<!DOCTYPE html>
<html>

<head>
 <meta charset="utf-8">
 <link rel="stylesheet" type="text/css" href="jeudame.css">
 
	<title>jeu</title>
</head>

<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script type="text/javascript">
   cestaquidejouer=0;// definit le joueur cest a qui de jouer
  var  tableaudecaseclike=new Array;
  function joueur(joueur1){this.nom=joueur; this.pion=new Array;}; 
  joueur1= new joueur('joueur1');
  joueur2= new joueur('joueur2');
  function deplacerpion(coupdepart,coupdarrivee)
  { 
    if (cestaquidejouer%2==0 && joueur1.pion.includes(coupdepart) && isdeplacer(coupdepart,coupdarrivee,cestaquidejouer) ){ c=joueur1.pion.indexOf(coupdepart); joueur1.pion.splice(c,1); $(document.getElementById(coupdepart)).removeClass("joueur1"); 
    d=joueur1.pion.push(coupdarrivee); $(document.getElementById(coupdarrivee)).addClass("joueur1");   ++cestaquidejouer;tableaudecaseclike=[]; 
    //socket.emit('game message', "C'est à joueur2 de jouer!");
    return };
    if (cestaquidejouer%2==1 && joueur2.pion.includes(coupdepart) && isdeplacer(coupdepart,coupdarrivee)  ){c=joueur2.pion.indexOf(coupdepart); joueur2.pion.splice(c,1); $(document.getElementById(coupdepart)).removeClass("joueur2"); 
    d=joueur2.pion.push(coupdarrivee); $(document.getElementById(coupdarrivee)).addClass("joueur2");   ++cestaquidejouer; tableaudecaseclike=[]; 
    //socket.emit('game message', "C'est à joueur1 de jouer!");
    return }

//trouver coupeliminer
    if(coupdepart<=10&&coupdepart>5 || coupdepart<=20&&coupdepart>15 || coupdepart<=30&&coupdepart>25 || coupdepart<=40&&coupdepart>35|| coupdepart<=50&&coupdepart>45 ){
      coupeliminer=  (parseInt(coupdepart)+parseInt(coupdarrivee)+1)/2;
    }
    else
      coupeliminer= (parseInt(coupdepart)+parseInt(coupdarrivee)-1)/2;

    if (cestaquidejouer%2==0 && joueur1.pion.includes(coupdepart) && iseliminer(coupdepart,coupdarrivee) && joueur2.pion.includes(coupeliminer.toString())){ c=joueur1.pion.indexOf(coupdepart); joueur1.pion.splice(c,1); $(document.getElementById(coupdepart)).removeClass("joueur1"); 
    d=joueur1.pion.push(coupdarrivee); $(document.getElementById(coupdarrivee)).addClass("joueur1");
    
    c2=joueur2.pion.indexOf(coupeliminer);joueur2.pion.splice(c2,1); $(document.getElementById(coupeliminer)).removeClass("joueur2");   ++cestaquidejouer;tableaudecaseclike=[]; 
    //socket.emit('game message', "C'est à joueur2 de jouer!");
    return }


    if (cestaquidejouer%2==1 && joueur2.pion.includes(coupdepart) && iseliminer(coupdepart,coupdarrivee) && joueur1.pion.includes(coupeliminer.toString()) ){c=joueur2.pion.indexOf(coupdepart); joueur2.pion.splice(c,1); $(document.getElementById(coupdepart)).removeClass("joueur2"); 
    d=joueur2.pion.push(coupdarrivee); $(document.getElementById(coupdarrivee)).addClass("joueur2");
    c2=joueur1.pion.indexOf(coupeliminer);joueur1.pion.splice(c2,1); $(document.getElementById(coupeliminer)).removeClass("joueur1");   ++cestaquidejouer; tableaudecaseclike=[]; 
    //socket.emit('game message', "C'est à joueur1 de jouer!"); 
    return}
  }

  function isdeplacer(coupdepart,coupdarrivee,cestaquidejouer)
  {
    if(!$(document.getElementById(coupdarrivee)).hasClass("joueur1") && !$(document.getElementById(coupdarrivee)).hasClass("joueur2")){
     if(coupdepart<=5 && (coupdarrivee-coupdepart==4 || coupdarrivee-coupdepart==5) && cestaquidejouer%2==0 )
        return 1;
      if((coupdepart<=10&&coupdepart>5 || coupdepart<=20&&coupdepart>15 || coupdepart<=30&&coupdepart>25 || coupdepart<=40&&coupdepart>35 ) && (coupdarrivee-coupdepart==5 || coupdarrivee-coupdepart==6|| coupdarrivee-coupdepart==-5 || coupdarrivee-coupdepart==-4))
        return 1;
      if((coupdepart<=15&&coupdepart>10 || coupdepart<=25&&coupdepart>20 || coupdepart<=35&&coupdepart>30 || coupdepart<=45&&coupdepart>40 ) && (coupdarrivee-coupdepart==5 || coupdarrivee-coupdepart==4 || coupdarrivee-coupdepart==-5 || coupdarrivee-coupdepart==-6))
        return 1;
      if(coupdepart>45 && (coupdarrivee-coupdepart==-5 || coupdarrivee-coupdepart==-4))
        return 1;
    }
    else 
      return 0;

  }

  function iseliminer(coupdepart,coupdarrivee)
  {

    if(!$(document.getElementById(coupdarrivee)).hasClass("joueur1") && !$(document.getElementById(coupdarrivee)).hasClass("joueur2")){
      if(coupdepart<=10 && (coupdarrivee-coupdepart==9 || coupdarrivee-coupdepart==11))
        return 1;
      if((coupdepart<=40&&coupdepart>10) && (coupdarrivee-coupdepart==9 || coupdarrivee-coupdepart==11|| coupdarrivee-coupdepart==-9 || coupdarrivee-coupdepart==-11))
        return 1;
      if(coupdepart>40 && (coupdarrivee-coupdepart==-9 || coupdarrivee-coupdepart==-11))
        return 1;
    }
    else 
      return 0;

  }


  //creation des noeuds de jeu 
   function noeud(premeca,deiemeca,occup){
    this.premierecase= premeca; this.deuxiemecase=deiemeca; this.occupation=occup;}

$(document).ready(function(){
        $.each([0,1,2,3,4,5],function(n){$('tr:nth-child(2n) td:nth-child(2n+1)').
          addClass("casenoir");$('tr:nth-child(2n+1) td:nth-child(2n)').addClass("casenoir")});//initialisation du fond     
        var inc=0;
        //mise en place de lenvironnement
       for (var j= 1; j <= 10; j++) { 
          var u=(inc%2)+1;
          for (var i =u ; i <= 10; i+=2) {
          var g=i;
          var d=j;
          inc++;g.toString();d.toString();
          var dd='tr:nth-child('+d+') td:nth-child('+g+')';
          $(dd).attr("id", inc.toString()).on('click', function(){
                            if(tableaudecaseclike.length>=2){$(document.getElementById(tableaudecaseclike[0])).removeClass("selected");
                                                               $(document.getElementById(tableaudecaseclike[1])).removeClass("selected");          
                                                                tableaudecaseclike=[]; tableaudecaseclike.push(this.id);
                                                                 $(document.getElementById(tableaudecaseclike[0])).addClass("selected") ; return };
                             if ( tableaudecaseclike.length==0){ tableaudecaseclike.push(this.id);$(document.getElementById(tableaudecaseclike[0])).addClass("selected");return                  
                                     }
                               if( tableaudecaseclike.length==1){tableaudecaseclike.push(this.id); $(document.getElementById(tableaudecaseclike[0])).removeClass("selected"); $(document.getElementById(tableaudecaseclike[1])).removeClass("selected");                                         }      
                                   });
          $(dd).on('click',function(){ 
            if(tableaudecaseclike.length==2){
              socket.emit('deplacer',tableaudecaseclike[0]+' '+tableaudecaseclike[1]);
              deplacerpion(tableaudecaseclike[0],tableaudecaseclike[1]),$("p").html("C'est au jour "+cestaquidejouer);
            }
          }) ;
          if ( j<=4){ joueur1.pion.push(inc.toString())};//initialise le tableau du joueur 1
          if ( j>=7 ){ joueur2.pion.push(inc.toString())};
          if ( j%5>1){    }

          //permet de recup l´id en un click sur la case 
          $(dd).html(inc).css('font-color','white')
            };
         };
    


        $.each(joueur1.pion, function(j){$(document.getElementById(joueur1.pion[j])).addClass("joueur1" )});
        $.each(joueur2.pion, function(j){$(document.getElementById(joueur2.pion[j])).addClass("joueur2" )});
       
       

        
       
        
        

    
}); 
</script>

<p >voiLA</p>

<div id="container">
 <div class="right">
    <ul id="messages">hello!!!!!!</ul>
          <input id="m" autocomplete="off" /><button id="send">Send</button>

   </div>
 
 <table >

<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
<tr><td> </td> <td>  </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>
</table>
 <div id="test">
        <div class="left">
             </div>
         </div>
 
</div>

</body>



<script>
var socket = io.connect('http://localhost:8080'); // émission 'connection'
$(document).ready(function(){
  var name = prompt("Votre nom","guest");
        if(name=="" || name==null){
          name = "guest";
      }

      socket.emit("add user",name);

      socket.on('add user',function(data){
          appendMessage(data.username+" has joined the chat room!");
        });
      socket.on('user left',function(data){
          appendMessage(data.username+" has left the chat room!");
        });

      socket.on('chat message', function(data){
          appendMessage(data.username+": "+data.message);
        });

      socket.on('game message', function(data){
          appendMessage("GAME PLAY :"+data.message);
        });

      socket.on('deplacer', function(data){
        a=data.message.split(" ");
        deplacerpion(a[0],a[1]);
        if(cestaquidejouer%2==0)
          $("p").html("C'est au jour "+cestaquidejouer+ " et c'est à joueur1 de jouer!");
        else
          $("p").html("C'est au jour "+cestaquidejouer+ " et c'est à joueur2 de jouer!");
        });

      $('#send').click(function(){
          var text = $('#m').val();
          socket.emit('chat message', text);
          $('#m').val('');
          return false;
        });

      $("#m").keydown(function(event){
          if ( event.which == 13 ){
            $('#send').click();
          }
        });

      function appendMessage(msg){
          $('#messages').append($('<li>').text(msg));
          var message = document.getElementById("dropzone");
          message.scrollTop = message.scrollHeight;

        }

});
</script>


</html>